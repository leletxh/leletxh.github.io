<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.20" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const useChoice = localStorage.getItem('vuepress-color-scheme')
      const systemStatus =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (useChoice === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (useChoice === 'dark' || systemStatus) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <title>SiliconFlow TTS 服务配置指南 | CABM</title><meta name="description" content="SiliconFlow TTS 语音合成服务的配置和使用指南，支持情感识别和角色情感音色">
    <link rel="preload" href="/assets/style-B3-VMakp.css" as="style"><link rel="stylesheet" href="/assets/style-B3-VMakp.css">
    <link rel="modulepreload" href="/assets/app-CttgXvaN.js"><link rel="modulepreload" href="/assets/TTS_SILDLC.html-b_OCQ88e.js">
    <link rel="prefetch" href="/assets/CONTRIBUTING.html-D1OY102W.js" as="script"><link rel="prefetch" href="/assets/LICENSE.html-CuE13UJw.js" as="script"><link rel="prefetch" href="/assets/index.html-8XvZiUf0.js" as="script"><link rel="prefetch" href="/assets/get-started.html-CdSL_Yps.js" as="script"><link rel="prefetch" href="/assets/DOCKER_PULL_GUIDE.html-DlShD7S1.js" as="script"><link rel="prefetch" href="/assets/TTS_GPTSoVITS.html-CD9aWkJp.js" as="script"><link rel="prefetch" href="/assets/TTS_SIL.html-D7HVlZIr.js" as="script"><link rel="prefetch" href="/assets/VISTR_GITHUB.html-BVDdhgkR.js" as="script"><link rel="prefetch" href="/assets/WINDOWS_DEPLOY_GUIDE.html-B1PijL7G.js" as="script"><link rel="prefetch" href="/assets/404.html-CWb_jMVS.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/"><img class="vp-site-logo" src="https://vuejs.press/images/hero.png" alt="CABM"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">CABM</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/" aria-label="CABM"><!--[--><!--[--><!--]--><!--]-->CABM<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/get-started.html" aria-label="快速开始"><!--[--><!--[--><!--]--><!--]-->快速开始<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/" aria-label="CABM"><!--[--><!--[--><!--]--><!--]-->CABM<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/get-started.html" aria-label="快速开始"><!--[--><!--[--><!--]--><!--]-->快速开始<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">SiliconFlow TTS 服务配置指南 <!----></p><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div><h1 id="siliconflow-tts-服务配置指南" tabindex="-1"><a class="header-anchor" href="#siliconflow-tts-服务配置指南"><span>SiliconFlow TTS 服务配置指南</span></a></h1><h2 id="概述" tabindex="-1"><a class="header-anchor" href="#概述"><span>概述</span></a></h2><p>本指南将帮助您配置和使用 SiliconFlow 提供的 TTS (Text-to-Speech) 服务。SiliconFlow TTS 服务基于 FunAudioLLM/CosyVoice2-0.5B 模型，提供高质量的语音合成功能，并用微调过的BRET模型支持<strong>情感识别</strong>和<strong>角色情感音色</strong>功能。</p><h2 id="前置要求" tabindex="-1"><a class="header-anchor" href="#前置要求"><span>前置要求</span></a></h2><ul><li>Python 3.7+</li><li>requests 库</li><li>transformers 库 (用于情感分析)</li><li>torch 库 (用于BERT模型)</li><li>有效的 SiliconFlow API 密钥</li></ul><h2 id="环境变量配置" tabindex="-1"><a class="header-anchor" href="#环境变量配置"><span>环境变量配置</span></a></h2><p>在使用 SiliconFlow TTS 服务之前，您需要配置以下环境变量：</p><table><thead><tr><th>环境变量</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td><code>TTS_SERVICE_METHOD</code></td><td><code>siliconflow</code></td><td>TTS 服务类型，设置为 <code>siliconflow</code></td></tr><tr><td><code>TTS_SERVICE_URL_SiliconFlow</code></td><td><code>https://api.siliconflow.cn/v1</code></td><td>SiliconFlow API 基础URL</td></tr><tr><td><code>TTS_SERVICE_API_KEY</code></td><td>无</td><td><strong>必需</strong> - 您的 SiliconFlow API 密钥</td></tr></tbody></table><h3 id="配置示例" tabindex="-1"><a class="header-anchor" href="#配置示例"><span>配置示例</span></a></h3><p><strong>Windows (.env 文件)</strong></p><div class="language-env line-numbers-mode" data-highlighter="prismjs" data-ext="env"><pre><code><span class="line">TTS_SERVICE_METHOD=siliconflow</span>
<span class="line">TTS_SERVICE_URL_SiliconFlow=https://api.siliconflow.cn/v1</span>
<span class="line">TTS_SERVICE_API_KEY=your_api_key_here</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Linux/macOS (环境变量)</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token builtin class-name">export</span> <span class="token assign-left variable">TTS_SERVICE_METHOD</span><span class="token operator">=</span>siliconflow</span>
<span class="line"><span class="token builtin class-name">export</span> <span class="token assign-left variable">TTS_SERVICE_URL_SiliconFlow</span><span class="token operator">=</span>https://api.siliconflow.cn/v1</span>
<span class="line"><span class="token builtin class-name">export</span> <span class="token assign-left variable">TTS_SERVICE_API_KEY</span><span class="token operator">=</span>your_api_key_here</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="功能特性" tabindex="-1"><a class="header-anchor" href="#功能特性"><span>功能特性</span></a></h2><h3 id="_1-情感识别功能-🎭" tabindex="-1"><a class="header-anchor" href="#_1-情感识别功能-🎭"><span>1. 情感识别功能 🎭</span></a></h3><p>系统集成了BERT情感分析模型，能够自动识别文本情感并选择对应的音色：</p><p><strong>支持的情感类型（15种）：</strong></p><ul><li>高兴、悲伤、愤怒、惊讶、恐惧</li><li>厌恶、中性、害羞、兴奋、舒适</li><li>紧张、爱慕、委屈、骄傲、困惑</li></ul><p><strong>情感识别流程：</strong></p><ol><li>输入文本自动进行情感分析</li><li>根据检测到的情感选择对应的参考音频</li><li>使用情感匹配的音色进行语音合成</li></ol><h3 id="_2-角色情感音色系统-🎨" tabindex="-1"><a class="header-anchor" href="#_2-角色情感音色系统-🎨"><span>2. 角色情感音色系统 🎨</span></a></h3><p>每个角色可以配置多种情感的参考音频：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">replace/role/</span>
<span class="line">├── 银狼/</span>
<span class="line">│   ├── BERT/                    # BERT情感分析模型</span>
<span class="line">│   │   ├── config.json</span>
<span class="line">│   │   ├── model.safetensors    # 模型文件（需单独下载）</span>
<span class="line">│   │   └── ...</span>
<span class="line">│   ├── refAudio/                # 情感参考音频</span>
<span class="line">│   │   ├── 高兴/</span>
<span class="line">│   │   │   └── 看招，系统崩溃！紧张什么，对付几个公司的杂鱼，很简单的。.wav</span>
<span class="line">│   │   ├── 悲伤/</span>
<span class="line">│   │   │   └── 唉，一个两个还好说，这次玩的有点大，基本上全部阵亡。这路估计不行。.wav</span>
<span class="line">│   │   ├── 愤怒/</span>
<span class="line">│   │   │   └── 毕竟，你不知道假面愚者为了找乐子会玩出什么花样.wav</span>
<span class="line">│   │   ├── 中性/</span>
<span class="line">│   │   │   └── 今天天气不错.wav</span>
<span class="line">│   │   └── ...                  # 其他情感目录</span>
<span class="line">│   └── config.json              # 角色配置文件</span>
<span class="line">└── 其他角色/</span>
<span class="line">    └── ...</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-自定义音色管理" tabindex="-1"><a class="header-anchor" href="#_3-自定义音色管理"><span>3. 自定义音色管理</span></a></h3><ul><li><strong>自动加载远程音色</strong>：启动时自动获取已上传的自定义音色列表</li><li><strong>本地音色上传</strong>：自动扫描并上传角色情感音色</li><li><strong>音色缓存</strong>：避免重复上传相同的音色文件</li><li><strong>情感音色映射</strong>：自动建立角色-情感-音色的映射关系</li></ul><h3 id="_4-支持的音频格式" tabindex="-1"><a class="header-anchor" href="#_4-支持的音频格式"><span>4. 支持的音频格式</span></a></h3><ul><li><strong>输入格式</strong>：WAV 文件（用于音色训练）</li><li><strong>输出格式</strong>：WAV, MP3, PCM, OPUS</li><li><strong>采样率</strong>：支持多种采样率配置</li></ul><h2 id="安装和配置" tabindex="-1"><a class="header-anchor" href="#安装和配置"><span>安装和配置</span></a></h2><h3 id="_1-安装依赖" tabindex="-1"><a class="header-anchor" href="#_1-安装依赖"><span>1. 安装依赖</span></a></h3><p>确保安装了必要的Python包：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line">pip <span class="token function">install</span> transformers torch requests</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_2-下载bert模型" tabindex="-1"><a class="header-anchor" href="#_2-下载bert模型"><span>2. 下载BERT模型</span></a></h3><p><strong>重要：</strong> 在使用情感识别功能前，需要下载对应的BERT模型：</p><ol><li>访问 <a href="https://huggingface.co/FrozenFish/retrained_SilverWolf_Bert/tree/main" target="_blank" rel="noopener noreferrer">HuggingFace模型页面</a></li><li>下载完整的BERT模型文件到 <code>replace/role/银狼/BERT/</code> 目录</li><li>确保包含以下文件： <ul><li><code>config.json</code></li><li><code>model.safetensors</code></li><li><code>tokenizer_config.json</code></li><li><code>vocab.txt</code></li><li>其他配置文件</li></ul></li></ol><h3 id="_3-准备角色情感音频" tabindex="-1"><a class="header-anchor" href="#_3-准备角色情感音频"><span>3. 准备角色情感音频</span></a></h3><p>为每个角色准备不同情感的参考音频：</p><ol><li><strong>创建角色目录</strong>：<code>replace/role/{角色名}/</code></li><li><strong>创建情感目录</strong>：<code>replace/role/{角色名}/refAudio/{情感名}/</code></li><li><strong>放置音频文件</strong>：将对应情感的WAV文件放入相应目录</li></ol><p><strong>示例结构：</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">replace/role/银狼/refAudio/</span>
<span class="line">├── 高兴/</span>
<span class="line">│   └── 看招，系统崩溃！紧张什么，对付几个公司的杂鱼，很简单的。.wav</span>
<span class="line">├── 悲伤/</span>
<span class="line">│   └── 唉，一个两个还好说，这次玩的有点大，基本上全部阵亡。这路估计不行。.wav</span>
<span class="line">├── 愤怒/</span>
<span class="line">│   └── 毕竟，你不知道假面愚者为了找乐子会玩出什么花样.wav</span>
<span class="line">└── 中性/</span>
<span class="line">    └── 今天天气不错.wav</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="使用方法" tabindex="-1"><a class="header-anchor" href="#使用方法"><span>使用方法</span></a></h2><h3 id="_1-基本tts调用" tabindex="-1"><a class="header-anchor" href="#_1-基本tts调用"><span>1. 基本TTS调用</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> replace<span class="token punctuation">.</span>ttsapi_service <span class="token keyword">import</span> ttsService</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 初始化TTS服务</span></span>
<span class="line">tts <span class="token operator">=</span> ttsService<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 基本语音合成</span></span>
<span class="line">audio_data <span class="token operator">=</span> tts<span class="token punctuation">.</span>get_tts<span class="token punctuation">(</span><span class="token string">&quot;你好，世界！&quot;</span><span class="token punctuation">,</span> role<span class="token operator">=</span><span class="token string">&quot;银狼&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-情感识别tts" tabindex="-1"><a class="header-anchor" href="#_2-情感识别tts"><span>2. 情感识别TTS</span></a></h3><p>系统会自动进行情感分析并选择对应音色：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 高兴的文本 - 自动使用&quot;高兴&quot;情感音色</span></span>
<span class="line">audio_data <span class="token operator">=</span> tts<span class="token punctuation">.</span>get_tts<span class="token punctuation">(</span><span class="token string">&quot;我很高兴见到你！&quot;</span><span class="token punctuation">,</span> role<span class="token operator">=</span><span class="token string">&quot;银狼&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 悲伤的文本 - 自动使用&quot;悲伤&quot;情感音色  </span></span>
<span class="line">audio_data <span class="token operator">=</span> tts<span class="token punctuation">.</span>get_tts<span class="token punctuation">(</span><span class="token string">&quot;这真是太糟糕了，我很伤心。&quot;</span><span class="token punctuation">,</span> role<span class="token operator">=</span><span class="token string">&quot;银狼&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 愤怒的文本 - 自动使用&quot;愤怒&quot;情感音色</span></span>
<span class="line">audio_data <span class="token operator">=</span> tts<span class="token punctuation">.</span>get_tts<span class="token punctuation">(</span><span class="token string">&quot;你怎么能这样对我！我很生气！&quot;</span><span class="token punctuation">,</span> role<span class="token operator">=</span><span class="token string">&quot;银狼&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-情感分析日志" tabindex="-1"><a class="header-anchor" href="#_3-情感分析日志"><span>3. 情感分析日志</span></a></h3><p>系统会输出详细的情感分析信息：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">情感分析 (银狼): &#39;我很高兴见到你！&#39; -&gt; 高兴 (置信度: 0.9234)</span>
<span class="line">使用角色 银狼 的 高兴 情感音色</span>
<span class="line">✅ 成功生成音频 (情感: 高兴)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="高级配置" tabindex="-1"><a class="header-anchor" href="#高级配置"><span>高级配置</span></a></h2><h3 id="_1-角色配置文件" tabindex="-1"><a class="header-anchor" href="#_1-角色配置文件"><span>1. 角色配置文件</span></a></h3><p>每个角色可以有自己的配置文件 <code>replace/role/{角色名}/config.json</code>：</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;ref_audio&quot;</span><span class="token operator">:</span> <span class="token string">&quot;银狼.wav&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;ref_text&quot;</span><span class="token operator">:</span> <span class="token string">&quot;骇入空间站的时候，我随手改了下螺丝咕姆的画像，不过…最后还是改回去了。&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;ref_lang&quot;</span><span class="token operator">:</span> <span class="token string">&quot;zh&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;BERTmodel&quot;</span><span class="token operator">:</span> <span class="token string">&quot;BERT/&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;multiREF&quot;</span><span class="token operator">:</span> <span class="token string">&quot;refAudio/&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-情感映射配置" tabindex="-1"><a class="header-anchor" href="#_2-情感映射配置"><span>2. 情感映射配置</span></a></h3><p>系统支持15种情感类型，可以根据需要扩展：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line">emotion_map <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token number">0</span><span class="token punctuation">:</span> <span class="token string">&quot;高兴&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span> <span class="token string">&quot;悲伤&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span> <span class="token string">&quot;愤怒&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">:</span> <span class="token string">&quot;惊讶&quot;</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">:</span> <span class="token string">&quot;恐惧&quot;</span><span class="token punctuation">,</span> </span>
<span class="line">    <span class="token number">5</span><span class="token punctuation">:</span> <span class="token string">&quot;厌恶&quot;</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">:</span> <span class="token string">&quot;中性&quot;</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">:</span> <span class="token string">&quot;害羞&quot;</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">:</span> <span class="token string">&quot;兴奋&quot;</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">:</span> <span class="token string">&quot;舒适&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token number">10</span><span class="token punctuation">:</span> <span class="token string">&quot;紧张&quot;</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">:</span> <span class="token string">&quot;爱慕&quot;</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">:</span> <span class="token string">&quot;委屈&quot;</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">:</span> <span class="token string">&quot;骄傲&quot;</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">:</span> <span class="token string">&quot;困惑&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="错误处理" tabindex="-1"><a class="header-anchor" href="#错误处理"><span>错误处理</span></a></h2><h3 id="常见问题及解决方案" tabindex="-1"><a class="header-anchor" href="#常见问题及解决方案"><span>常见问题及解决方案</span></a></h3><ol><li><p><strong>BERT模型未找到</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">❌ 银狼的BERT模型加载失败: [Errno 2] No such file or directory</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>解决方案</strong>：</p><ul><li>确保已下载BERT模型到正确目录</li><li>检查模型文件是否完整</li><li>验证目录权限</li></ul></li><li><p><strong>情感音色未找到</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">未找到 高兴 情感音色，使用中性情感音色</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>解决方案</strong>：</p><ul><li>检查 <code>refAudio/高兴/</code> 目录是否存在</li><li>确认目录中有WAV音频文件</li><li>验证文件名格式正确</li></ul></li><li><p><strong>API 密钥未设置</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">ValueError: TTS_SERVICE_API_KEY 未设置，请配置环境变量。</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>解决方案</strong>：检查并正确设置 <code>TTS_SERVICE_API_KEY</code> 环境变量</p></li><li><p><strong>音色上传失败</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">❌ 上传音色失败 [银狼_高兴]: 400, Bad Request</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>解决方案</strong>：</p><ul><li>检查音频文件格式（必须是 WAV）</li><li>确认参考文本内容正确</li><li>验证 API 密钥权限</li></ul></li></ol><h2 id="性能优化建议" tabindex="-1"><a class="header-anchor" href="#性能优化建议"><span>性能优化建议</span></a></h2><ol><li><p><strong>模型加载优化</strong></p><ul><li>BERT模型按需加载，避免内存浪费</li><li>首次使用角色时会自动加载对应模型</li><li>支持CUDA加速（如果可用）</li></ul></li><li><p><strong>音色管理</strong></p><ul><li>合理控制音色数量，避免过多占用存储</li><li>定期清理不使用的音色</li><li>使用MD5哈希避免重复上传</li></ul></li><li><p><strong>请求优化</strong></p><ul><li>批量处理短文本可提高效率</li><li>避免过长的单次文本输入</li><li>对相同文本和参数的请求考虑实现本地缓存</li></ul></li></ol><h2 id="注意事项" tabindex="-1"><a class="header-anchor" href="#注意事项"><span>注意事项</span></a></h2><ol><li><strong>模型文件大小</strong>：BERT模型文件较大（约390MB），请确保有足够存储空间</li><li><strong>API 限制</strong>：请遵守 SiliconFlow 的 API 调用频率限制</li><li><strong>音频质量</strong>：上传的参考音频质量会直接影响合成效果</li><li><strong>文本长度</strong>：单次请求的文本长度建议控制在合理范围内</li><li><strong>网络环境</strong>：确保服务器能够正常访问 SiliconFlow API</li><li><strong>情感识别准确性</strong>：BERT模型的训练数据会影响情感识别准确性</li></ol><h2 id="故障排查" tabindex="-1"><a class="header-anchor" href="#故障排查"><span>故障排查</span></a></h2><p>如果遇到问题，请按以下步骤排查：</p><ol><li><strong>检查BERT模型</strong>：确认模型文件完整且路径正确</li><li><strong>验证情感音频</strong>：检查各情感目录下的音频文件</li><li><strong>检查环境变量配置</strong></li><li><strong>验证 API 密钥有效性</strong></li><li><strong>确认网络连接正常</strong></li><li><strong>查看详细错误日志</strong></li></ol><h2 id="示例代码" tabindex="-1"><a class="header-anchor" href="#示例代码"><span>示例代码</span></a></h2><h3 id="完整使用示例" tabindex="-1"><a class="header-anchor" href="#完整使用示例"><span>完整使用示例</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">import</span> logging</span>
<span class="line"><span class="token keyword">from</span> replace<span class="token punctuation">.</span>ttsapi_service <span class="token keyword">import</span> ttsService</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 设置日志级别</span></span>
<span class="line">logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span>level<span class="token operator">=</span>logging<span class="token punctuation">.</span>INFO<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 初始化TTS服务</span></span>
<span class="line">tts <span class="token operator">=</span> ttsService<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 测试不同情感的文本</span></span>
<span class="line">test_texts <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">(</span><span class="token string">&quot;我很高兴见到你！&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;高兴&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">(</span><span class="token string">&quot;这真是太糟糕了，我很伤心。&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;悲伤&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> </span>
<span class="line">    <span class="token punctuation">(</span><span class="token string">&quot;你怎么能这样对我！我很生气！&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;愤怒&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">(</span><span class="token string">&quot;今天天气不错。&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;中性&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">for</span> text<span class="token punctuation">,</span> expected_emotion <span class="token keyword">in</span> test_texts<span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">try</span><span class="token punctuation">:</span></span>
<span class="line">        audio_data <span class="token operator">=</span> tts<span class="token punctuation">.</span>get_tts<span class="token punctuation">(</span>text<span class="token punctuation">,</span> role<span class="token operator">=</span><span class="token string">&quot;银狼&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;✅ 成功生成音频: &#39;</span><span class="token interpolation"><span class="token punctuation">{</span>text<span class="token punctuation">}</span></span><span class="token string">&#39; -&gt; </span><span class="token interpolation"><span class="token punctuation">{</span>expected_emotion<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;❌ 生成失败: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过以上配置和使用方法，您可以充分利用 SiliconFlow TTS 服务的情感识别功能，为您的应用添加智能化的情感语音合成能力。</p></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">最近更新：: </span><time class="meta-item-info" datetime="2025-08-05T07:18:32.000Z" data-allow-mismatch>2025/8/5 07:18</time></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: kuw9549@dingtalk.com">FrozenFisher</span><!----><!--]--><!--]--></span></div></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-CttgXvaN.js" defer></script>
  </body>
</html>
